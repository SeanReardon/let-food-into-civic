version: "3.8"

services:
  let-food-into-civic:
    image: ghcr.io/seanreardon/let-food-into-civic:latest
    container_name: let-food-into-civic
    restart: unless-stopped
    ports:
      - "127.0.0.1:8042:8080"  # Exposed on localhost:8042, nginx will reverse proxy to this
    env_file:
      - .env  # Load secrets from .env file
    environment:
      - LOG_LEVEL=INFO
      # DTMF tone configuration
      - UNLOCK_DIGIT=5
      - TONE_DURATION_REPEATS=8   # 8 x 250ms = ~2 seconds of tone
      - PAUSE_DURATION=0.5        # 0.5 second pause between tones
      - ITERATIONS=6              # Repeat 6 times
      # Telnyx configuration (secrets in .env file):
      # - TELNYX_LET_FOOD_INTO_CIVIC_KEY=your_api_key
      # - TELNYX_PHONE_NUMBER=+1XXXXXXXXXX
      # - NOTIFY_NUMBERS=+1XXXXXXXXXX,+1YYYYYYYYYY
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8080/health')"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s
