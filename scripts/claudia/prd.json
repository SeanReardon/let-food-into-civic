{
  "project": "let-food-into-civic",
  "version": "0.1.0",
  "branchName": "main",
  "userStories": [
    {
      "id": "let-food-into-civic-00006",
      "title": "Update contact email to contact@contrived.com",
      "acceptanceCriteria": [
        "Change all instances of sean.reardon@contrived.com to contact@contrived.com",
        "Update in the public landing page (index route)",
        "Update in the SMS consent page (/sms-consent)",
        "Verify mailto: links work correctly"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Simple find/replace. There are references in the / route HTML and /sms-consent route HTML."
    },
    {
      "id": "let-food-into-civic-00001",
      "title": "Add network detection helper to distinguish local vs remote requests",
      "acceptanceCriteria": [
        "Create is_local_network(request) helper function in main.py",
        "Detect private IP ranges: 192.168.x.x, 10.x.x.x, 172.16-31.x.x",
        "Also treat 127.0.0.1 and ::1 as local",
        "Check X-Forwarded-For header when behind reverse proxy (nginx)",
        "Return True for local network, False for remote"
      ],
      "priority": 1,
      "passes": true,
      "notes": "This is the foundation for the local-only snooze UI. Nginx forwards requests, so we need to check X-Forwarded-For. Be careful with header spoofing - only trust if coming from known proxy."
    },
    {
      "id": "let-food-into-civic-00002",
      "title": "Add persistent snooze state file for per-recipient notifications",
      "acceptanceCriteria": [
        "Create snooze state file at /app/data/snooze.json",
        "Store snooze state for each recipient: {\"linda\": false, \"sean\": false}",
        "false = not snoozed (will receive notification), true = snoozed (skip next notification)",
        "Create load_snooze_state() function that returns dict",
        "Create save_snooze_state(state) function that writes to file",
        "Initialize file with both NOT snoozed (false) if it doesn't exist",
        "Map phone numbers to names: +14693059242=linda, +12149090499=sean"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Use JSON format for the snooze file. The phone-to-name mapping can be a simple dict constant. Normalize phone numbers before comparison using existing normalize_phone_number() function. Snooze=true means SKIP, snooze=false means SEND."
    },
    {
      "id": "let-food-into-civic-00003",
      "title": "Create local-only snooze UI for managing recipient notifications",
      "acceptanceCriteria": [
        "Modify / route to show snooze UI when is_local_network() returns True",
        "Show existing public landing page when is_local_network() returns False",
        "Display two recipients: Linda (top) and Sean (bottom)",
        "Show phone number formatted nicely under each name",
        "Each recipient has a 'Snooze' toggle reflecting current state from snooze.json",
        "UI is mobile-friendly with large tap targets",
        "Clear text indicating 'snoozed = skip next event only, auto-resets after gate unlocks'"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Keep the UI simple and clean. Match the existing style of the landing page. Use inline HTML like the existing pages do. Toggles should be large and easy to tap on mobile. When snoozed, show a moon/sleep icon or similar."
    },
    {
      "id": "let-food-into-civic-00004",
      "title": "Add endpoint to snooze/unsnooze recipient notifications",
      "acceptanceCriteria": [
        "Add POST /admin/snooze endpoint",
        "Accept JSON body: {\"recipient\": \"linda\", \"snoozed\": true}",
        "Validate recipient is 'linda' or 'sean'",
        "Update snooze.json with new state",
        "Return JSON with success status and current snooze state of both recipients",
        "Only allow from local network (return 403 if remote)"
      ],
      "priority": 4,
      "passes": true,
      "notes": "The snooze UI will call this endpoint via JavaScript fetch. Could also support form-based submission that redirects back to / for no-JS fallback."
    },
    {
      "id": "let-food-into-civic-00005",
      "title": "Modify SMS notification logic to respect snooze state and auto-reset",
      "acceptanceCriteria": [
        "In send_sms_notifications(), read snooze state from snooze.json before sending",
        "Skip sending to recipients who are snoozed (snoozed=true)",
        "Log which recipients were skipped due to snooze: 'ðŸ˜´ Skipping Linda (snoozed)'",
        "After notification attempt completes, reset all snooze states to false",
        "Write reset state back to snooze.json",
        "Reset happens regardless of SMS success/failure"
      ],
      "priority": 5,
      "passes": true,
      "notes": "The reset must happen after the event, not before. This ensures snooze is always 'just for the next event'. Even if SMS fails, we reset - the event happened, the gate was unlocked. Use ðŸ˜´ emoji in logs for snoozed recipients."
    },
    {
      "id": "let-food-into-civic-00007",
      "title": "Add toggle button to switch between local snooze UI and public landing page views",
      "acceptanceCriteria": [
        "On snooze UI (local view): add 'View Public Page' button near the 'Local network access only' text at bottom",
        "On public landing page: add 'View Local Controls' button at bottom (only functional from local network)",
        "Use query parameter ?view=public or ?view=local to override the automatic network detection",
        "When on local network viewing public page, the toggle returns to snooze UI",
        "When remote user clicks 'View Local Controls', show 403 or redirect back (they can't access it)",
        "Button styling matches existing page design, subtle but visible"
      ],
      "priority": 1,
      "passes": true,
      "notes": "This lets local users preview what remote visitors see, and easily switch back. The ?view= parameter overrides is_local_network() for the page display only, not for admin actions. Remote users still can't access /admin/snooze even if they add ?view=local."
    },
    {
      "id": "let-food-into-civic-00008",
      "title": "Create JSON schema and log file for gate unlock events",
      "acceptanceCriteria": [
        "Create schemas/log.schema.json defining the event log structure",
        "Schema defines an array of event objects with 'timestamp' field (ISO8601 UTC string)",
        "Create /app/data/events.json log file (empty array if doesn't exist)",
        "Add load_events() function to read events from file",
        "Add append_event(timestamp) function to add new event and save",
        "Events are stored in chronological order"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Keep the schema simple - just timestamp for now. Future events could add caller_id or other metadata. Use /app/data/events.json to persist across container restarts."
    },
    {
      "id": "let-food-into-civic-00009",
      "title": "Log gate unlock events when voice webhook is triggered",
      "acceptanceCriteria": [
        "In handle_incoming_call(), record event timestamp in UTC ISO8601 format",
        "Call append_event() to persist the event to events.json",
        "Log entry happens before SMS notifications are sent",
        "Existing logging behavior unchanged (still logs to app.log)",
        "Event is recorded regardless of SMS success/failure"
      ],
      "priority": 3,
      "passes": true,
      "notes": "This captures every gate unlock event for historical analysis. The timestamp should be datetime.utcnow().isoformat() + 'Z' for proper UTC ISO8601."
    },
    {
      "id": "let-food-into-civic-00010",
      "title": "Add daily histogram chart showing events per day over last 60 days",
      "acceptanceCriteria": [
        "On local snooze UI, display a histogram chart below the snooze controls",
        "X-axis: last 60 days (most recent on right)",
        "Y-axis: count of events per day",
        "Use inline SVG or simple HTML/CSS bars (no external JS libraries)",
        "Days with zero events show as empty/minimal bar",
        "Show date labels for first day, last day, and maybe middle",
        "Chart title: 'Gate Unlocks - Last 60 Days'"
      ],
      "priority": 4,
      "passes": false,
      "notes": "Generate the chart server-side as inline SVG for simplicity. Read events from events.json, filter to last 60 days, group by date. Dallas timezone for day boundaries (America/Chicago)."
    },
    {
      "id": "let-food-into-civic-00011",
      "title": "Add polar chart showing time-of-day distribution of gate unlock events",
      "acceptanceCriteria": [
        "On local snooze UI, display a polar/radial chart showing hourly distribution",
        "24 segments representing hours of the day (midnight at top, noon at bottom)",
        "Segment size/color intensity based on event count for that hour",
        "Times converted to Dallas timezone (America/Chicago) before binning",
        "Use inline SVG (no external JS libraries)",
        "Chart title: 'Unlock Times (Dallas)'",
        "Show hour labels around the circle (12am, 6am, 12pm, 6pm at minimum)"
      ],
      "priority": 5,
      "passes": false,
      "notes": "This shows delivery patterns - when do most unlocks happen? Use pytz or zoneinfo to convert UTC timestamps to America/Chicago before extracting hour. Consider all historical events, not just last 60 days."
    }
  ]
}
